import React, { useRef, useState } from "react";
import { AgGridReact } from "ag-grid-react";
import { AllCommunityModule, ModuleRegistry } from "ag-grid-community";
ModuleRegistry.registerModules([AllCommunityModule]);

import "ag-grid-community/styles/ag-grid.css";
import "ag-grid-community/styles/ag-theme-quartz.css";

function App() {
  const gridRef = useRef(null);
  const [username, setUsername] = useState("");
  const [rowData, setRowData] = useState([]);
  const [loading, setLoading] = useState(false);

  const columnDefs = [
    { headerName: "User ID", field: "serialNumber" },
    { headerName: "SSO ID", field: "userId" },
    { headerName: "First Name", field: "firstName" },
    { headerName: "Last Name", field: "lastName" },
    { headerName: "Region", field: "region" },
    { headerName: "Department", field: "department" },
    { headerName: "Sub Department", field: "subDepartment" },
  ];

  const defaultColDef = { sortable: true, filter: true, flex: 1 };

  const handleSearch = async () => {
    const u = username.trim();
    if (!u) return alert("Please enter a username");

    setLoading(true);
    try {
      const resp = await fetch(
        `http://localhost:8080/EmployeeRights/Byuserid/${encodeURIComponent(u)}`
      );
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();
      setRowData(Array.isArray(data) ? data : [data]); // normalize shape
    } catch (e) {
      console.error(e);
      alert("Failed to fetch. Check the server/console.");
      setRowData([]);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ padding: 16 }}>
      <h2>User Rights</h2>

      {/* Search box + button */}
      <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
        <input
          type="text"
          placeholder="Enter username (e.g., john_doe)"
          value={username}
          onChange={(e) => setUsername(e.target.value)}
          style={{ padding: 8, minWidth: 260 }}
        />
        <button onClick={handleSearch} disabled={loading} style={{ padding: "8px 14px" }}>
          {loading ? "Loading..." : "Search"}
        </button>
      </div>

      {/* Grid */}
      <div className="ag-theme-quartz" style={{ height: 420 }}>
        <AgGridReact
          ref={gridRef}
          columnDefs={columnDefs}
          defaultColDef={defaultColDef}
          rowData={rowData}
          animateRows
        />
      </div>
    </div>
  );
}

export default App;
